name: Manual AUR Update

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Release tag (e.g. v2.1.0). Leave empty for latest.'
        required: false

jobs:
  trigger-aur:
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Resolve tag
        id: resolve
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          if [ -n "${{ github.event.inputs.tag }}" ]; then
            TAG="${{ github.event.inputs.tag }}"
          else
            TAG=$(gh api repos/Vadko/lbk-launcher/releases/latest --jq '.tag_name')
          fi
          echo "tag=$TAG" >> "$GITHUB_OUTPUT"
          echo "Resolved tag: $TAG"

      - name: Trigger AUR update workflow
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          TAG="${{ steps.resolve.outputs.tag }}"
          echo "Triggering AUR update for tag: $TAG"
          gh workflow run update-aur.yml --repo Vadko/lbk-launcher -f app_version="$TAG"
